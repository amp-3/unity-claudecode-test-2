class P{constructor(i){this.canvas=i,this.ctx=i.getContext("2d"),this.fadeAlpha=0,this.fadeDirection=0,this.notifications=[],this.notificationDuration=3,this.petalTimer=0,this.petalInterval=.3,this.petals=[]}render(i){switch(i.gameState){case"MENU":this.renderMenu(i);break;case"PLAYING":this.renderHUD(i);break;case"PAUSED":this.renderHUD(i),this.renderPauseMenu(i);break;case"LEVEL_UP":this.renderHUD(i),this.renderLevelUpMenu(i);break;case"GAME_OVER":this.renderGameOver(i);break}this.renderNotifications()}renderMenu(i){const t=this.ctx,e=this.canvas.width/2,l=this.canvas.height/2;t.save(),t.font="bold 48px Arial",t.fillStyle="#ffffff",t.textAlign="center",t.textBaseline="middle",t.shadowBlur=10,t.shadowColor="#00ff00",t.fillText("SPACE SURVIVOR",e,l-100);const a=200,s=50,n=e-a/2,f=l;t.fillStyle="rgba(0, 255, 0, 0.2)",t.fillRect(n,f,a,s),t.strokeStyle="#00ff00",t.lineWidth=2,t.strokeRect(n,f,a,s),t.font="24px Arial",t.fillStyle="#ffffff",t.fillText("PLAY",e,f+s/2),t.font="16px Arial",t.fillStyle="#888888",t.fillText("Use WASD to move, Mouse to aim and shoot",e,l+100),t.fillText("Press ESC to pause",e,l+130),i.highScore>0&&(t.font="20px Arial",t.fillStyle="#ffff00",t.fillText(`High Score: ${i.highScore}`,e,l+180)),t.restore()}renderHUD(i){const t=this.ctx,e=i.player;if(!e)return;t.save(),t.font="bold 24px Arial",t.fillStyle="#ffffff",t.textAlign="left",t.textBaseline="top",t.fillText(`Score: ${i.score}`,20,20),t.font="18px Arial",t.fillStyle="#ffffff",Math.min(200,this.canvas.width/2-40);const l=`Wave: ${i.spawnSystem.getCurrentWave()}`;if(t.fillText(l,20,50),i.spawnSystem.isInBetweenWaves())t.fillStyle="#ffff00",t.fillText("Wave Complete!",20,75);else{t.fillStyle="#ffffff";const r=`Enemies: ${i.spawnSystem.getEnemiesRemaining()}`;t.fillText(r,20,75)}this.renderHealthBar(20,110,e.health,e.maxHealth),i.levelingSystem&&(this.renderExperienceBar(i),this.renderLevel(i));const a=20,s=i.weaponSystem.getCurrentWeapon();t.font="16px Arial",t.fillStyle="#ffffff",t.textAlign="left";const n=Math.min(180,this.canvas.width/2-40),f=`Weapon: ${s.name}`;if(t.measureText(f).width>n){const r=`Weap: ${s.name}`;t.measureText(r).width>n?t.fillText(s.name,a,150):t.fillText(r,a,150)}else t.fillText(f,a,150);const d=i.weaponSystem.getWeaponTimeRemaining();d>0&&(t.fillStyle="#00ffff",t.fillText(`Time: ${d.toFixed(1)}s`,a,170)),t.textAlign="right",t.fillStyle="#ffffff";const y=Math.floor(i.gameTime/60),S=Math.floor(i.gameTime%60),v=`Time: ${y}:${S.toString().padStart(2,"0")}`,h=20;if(t.fillText(v,this.canvas.width-h,20),i.deltaTime>0){const r=Math.round(1/i.deltaTime);t.font="14px Arial",t.fillStyle="#888888",t.fillText(`FPS: ${r}`,this.canvas.width-h,45)}t.restore()}renderHealthBar(i,t,e,l){const a=this.ctx,s=150,n=20,f=e/l;a.fillStyle="rgba(255, 255, 255, 0.2)",a.fillRect(i,t,s,n);const o=f>.5?"#00ff00":f>.25?"#ffff00":"#ff0000";a.fillStyle=o,a.fillRect(i,t,s*f,n),a.strokeStyle="#ffffff",a.lineWidth=2,a.strokeRect(i,t,s,n),a.font="14px Arial",a.fillStyle="#ffffff",a.textAlign="center",a.textBaseline="middle",a.fillText(`${e}/${l}`,i+s/2,t+n/2)}renderExperienceBar(i){const t=this.ctx,e=i.levelingSystem.getCurrentLevelProgress(),l=300,a=12,s=(this.canvas.width-l)/2,n=10;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(s,n,l,a),t.fillStyle="#00aaff",t.fillRect(s,n,l*e.percentage,a),t.strokeStyle="#ffffff",t.lineWidth=1,t.strokeRect(s,n,l,a),t.font="11px Arial",t.fillStyle="#ffffff",t.textAlign="center",t.textBaseline="middle",t.fillText(`${e.current}/${e.total} EXP`,s+l/2,n+a/2)}renderLevel(i){const t=this.ctx,e=i.levelingSystem.getLevel(),l=300,a=(this.canvas.width-l)/2-60,s=16;t.font="bold 16px Arial",t.fillStyle="#ffff00",t.textAlign="center",t.textBaseline="middle",t.fillText(`LV ${e}`,a,s)}renderPauseMenu(i){const t=this.ctx,e=this.canvas.width/2,l=this.canvas.height/2;t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.save(),t.font="bold 48px Arial",t.fillStyle="#ffffff",t.textAlign="center",t.textBaseline="middle",t.shadowBlur=10,t.shadowColor="#ffffff",t.fillText("PAUSED",e,l-50),t.font="20px Arial",t.fillStyle="#aaaaaa",t.shadowBlur=0,t.fillText("Press ESC to resume",e,l+20),t.fillText("Press R to restart",e,l+50),t.restore()}renderGameOver(i){const t=this.ctx,e=this.canvas.width/2,l=this.canvas.height/2;t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.save(),t.font="bold 56px Arial",t.fillStyle="#ff0000",t.textAlign="center",t.textBaseline="middle",t.shadowBlur=20,t.shadowColor="#ff0000",t.fillText("GAME OVER",e,l-100),t.font="32px Arial",t.fillStyle="#ffffff",t.shadowBlur=10,t.shadowColor="#ffffff",t.fillText(`Final Score: ${i.score}`,e,l-30),i.score>=i.highScore&&(t.font="28px Arial",t.fillStyle="#ffff00",t.shadowColor="#ffff00",t.fillText("NEW HIGH SCORE!",e,l+20)),t.font="20px Arial",t.fillStyle="#aaaaaa",t.shadowBlur=0;const a=Math.floor(i.gameTime/60),s=Math.floor(i.gameTime%60);t.fillText(`Time Survived: ${a}:${s.toString().padStart(2,"0")}`,e,l+70),t.fillText(`Waves Completed: ${i.spawnSystem.getCurrentWave()-1}`,e,l+100),t.font="24px Arial",t.fillStyle="#00ff00",t.fillText("Press ENTER to return to menu",e,l+150),t.restore()}addNotification(i,t=3){this.notifications.push({text:i,duration:t,timeRemaining:t,alpha:1})}renderNotifications(){const i=this.ctx,t=this.canvas.width/2;let e=200;for(let l=this.notifications.length-1;l>=0;l--){const a=this.notifications[l];i.save(),i.font="20px Arial",i.fillStyle=`rgba(255, 255, 0, ${a.alpha})`,i.textAlign="center",i.textBaseline="middle",i.shadowBlur=10,i.shadowColor=`rgba(255, 255, 0, ${a.alpha})`,i.fillText(a.text,t,e),i.restore(),e+=30,a.timeRemaining-=1/60,a.alpha=Math.min(1,a.timeRemaining),a.timeRemaining<=0&&this.notifications.splice(l,1)}}renderLevelUpMenu(i){const t=this.ctx,e=this.canvas.width/2,l=this.canvas.height/2;t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,this.canvas.width,this.canvas.height),this.petalTimer+=i.deltaTime||.016,this.petalTimer>=this.petalInterval&&(this.createPetals(),this.petalTimer=0),this.updatePetals(i.deltaTime||.016),this.renderPetals(t),t.save(),t.font="bold 42px Arial",t.textAlign="center",t.textBaseline="middle";const a=Date.now()*.005,s=1+Math.sin(a*3)*.1,n=a*50%360;t.fillStyle=`hsl(${n}, 100%, 60%)`,t.shadowBlur=20+Math.sin(a*4)*5,t.shadowColor=t.fillStyle,t.save(),t.scale(s,s),t.fillText("LEVEL UP!",e/s,(l-120)/s),t.restore(),t.fillStyle="#ffffff",t.shadowBlur=30,t.shadowColor="#ffffff",t.globalAlpha=.3+Math.sin(a*6)*.2,t.fillText("LEVEL UP!",e,l-120),t.globalAlpha=1;const f=i.levelingSystem.getAvailableUpgrades(),o=180,d=140,y=20,S=o*3+y*2,v=e-S/2;for(let h=0;h<f.length;h++){const r=f[h],c=v+(o+y)*h,x=l-40;t.fillStyle="rgba(50, 50, 50, 0.9)",t.fillRect(c,x,o,d),t.strokeStyle="#00aaff",t.lineWidth=2,t.strokeRect(c,x,o,d),t.font="36px Arial",t.fillStyle="#ffffff",t.textAlign="center",t.shadowBlur=0,t.fillText(r.icon,c+o/2,x+40),t.font="bold 16px Arial",t.fillStyle="#ffff00",t.fillText(r.name,c+o/2,x+70),t.font="12px Arial",t.fillStyle="#cccccc";const g=r.description,A=o-10,w=g.split(" ");let p="",T=x+90;for(let m=0;m<w.length;m++){const u=p+w[m]+" ";t.measureText(u).width>A&&m>0?(t.fillText(p,c+o/2,T),p=w[m]+" ",T+=14):p=u}t.fillText(p,c+o/2,T),t.font="bold 14px Arial",t.fillStyle="#00ff00",t.fillText(`[${h+1}]`,c+o/2,x+d-10)}t.font="18px Arial",t.fillStyle="#aaaaaa",t.fillText("数字キー(1-3)または該当のカードをクリックして選択",e,l+140),t.restore()}createPetals(){const i=["#ff69b4","#ffb6c1","#ffc0cb","#ffdbec","#fff0f5"];for(let e=0;e<2;e++){const l=Math.random()*this.canvas.width,a={x:l,y:-20,baseX:l,vx:(Math.random()-.5)*5,vy:30+Math.random()*20,color:i[Math.floor(Math.random()*i.length)],width:6+Math.random()*4,height:8+Math.random()*6,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*2,swayAmplitude:5+Math.random()*10,swayFrequency:.2+Math.random()*.4,windForce:(Math.random()-.5)*3,gravity:20+Math.random()*10,mass:.5+Math.random()*.5,timeAlive:0,alpha:1};this.petals.push(a)}}updatePetals(i){for(let t=this.petals.length-1;t>=0;t--){const e=this.petals[t];e.timeAlive+=i,e.vy+=e.gravity*i;const l=Math.sin(e.timeAlive*1)*e.windForce*i/e.mass;e.vx+=l,e.vx*=.95,e.vy=Math.min(e.vy,80),e.baseX+=e.vx*i,e.y+=e.vy*i;const a=Math.sin(e.timeAlive*e.swayFrequency*Math.PI*2)*e.swayAmplitude*.7,s=Math.sin(e.timeAlive*e.swayFrequency*1.7*Math.PI*2)*e.swayAmplitude*.3;e.x=e.baseX+a+s;const n=Math.sin(e.timeAlive*.8)*.3;e.rotation+=(e.rotationSpeed+n)*i,(e.baseX<-e.swayAmplitude||e.baseX>this.canvas.width+e.swayAmplitude)&&(e.vx*=-.3,e.baseX=Math.max(-e.swayAmplitude,Math.min(this.canvas.width+e.swayAmplitude,e.baseX))),e.y>this.canvas.height+20&&this.petals.splice(t,1)}}renderPetals(i){i.save(),this.petals.forEach(t=>{i.save(),i.globalAlpha=t.alpha*.8,i.translate(t.x,t.y),i.rotate(t.rotation),i.fillStyle=t.color,i.fillRect(-t.width/2,-t.height/2,t.width,t.height),i.restore()}),i.restore()}clearPetals(){this.petals=[]}fadeOutPetals(i=.2){this.petals.forEach(e=>{e.fadeStartTime||(e.fadeStartTime=0,e.fadeDuration=i,e.originalAlpha=e.alpha)});const t=setInterval(()=>{let e=!0;this.petals.forEach(l=>{if(l.fadeStartTime!==void 0){l.fadeStartTime+=.016;const a=Math.min(1,l.fadeStartTime/l.fadeDuration);l.alpha=l.originalAlpha*(1-a),a<1&&(e=!1)}}),e&&(clearInterval(t),this.clearPetals())},16)}}export{P as UIManager};
