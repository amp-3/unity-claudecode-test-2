(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();const g="modulepreload",y=function(d){return"/"+d},u={},r=function(e,t,i){if(!t||t.length===0)return e();const a=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=y(s),s in u)return;u[s]=!0;const n=s.endsWith(".css"),h=n?'[rel="stylesheet"]':"";if(!!i)for(let p=a.length-1;p>=0;p--){const m=a[p];if(m.href===s&&(!n||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${h}`))return;const l=document.createElement("link");if(l.rel=n?"stylesheet":g,n||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),n)return new Promise((p,m)=>{l.addEventListener("load",p),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=s,window.dispatchEvent(n),!n.defaultPrevented)throw s})};class o{constructor(){this.canvas=null,this.ctx=null,this.lastTime=0,this.deltaTime=0,this.gameState="MENU",this.entities=new Map,this.systems=new Map,this.score=0,this.highScore=0,this.isPaused=!1,this.gameTime=0,this.gameArea={x:0,y:0,width:800,height:600,boundaryRadius:300},this.player=null,this.inputManager=null,this.weaponSystem=null,this.spawnSystem=null,this.uiManager=null,this.audioManager=null,this.particleSystem=null,this.saveSystem=null,this.levelingSystem=null,this.permanentUpgrades=null,o.instance=this}static getInstance(){return o.instance||(o.instance=new o),o.instance}async init(e){return this.canvas=e,this.ctx=e.getContext("2d"),this.setupCanvas(),await this.loadSystems(),await this.loadAssets(),this.setState("MENU"),!0}setupCanvas(){this.canvas.width=this.gameArea.width,this.canvas.height=this.gameArea.height,this.gameArea.x=this.canvas.width/2,this.gameArea.y=this.canvas.height/2,this.ctx.imageSmoothingEnabled=!1,window.addEventListener("resize",()=>this.handleResize()),this.handleResize()}handleResize(){const e=window.innerWidth,t=window.innerHeight,i=window.innerWidth<=768?2:4,a=e-i,s=t-i,n=a/this.canvas.width,h=s/this.canvas.height,c=Math.min(n,h);this.canvas.style.transform=`translate(-50%, -50%) scale(${c})`,this.canvas.style.transformOrigin="center",this.canvas.style.position="absolute",this.canvas.style.top="50%",this.canvas.style.left="50%",this.inputManager&&(this.inputManager.updateCanvasScale(c),this.inputManager.updateCanvasPosition(e/2-this.canvas.width*c/2,t/2-this.canvas.height*c/2))}async loadSystems(){const{InputManager:e}=await r(()=>import("./InputManager-2f58337d.js"),[]),{WeaponSystem:t}=await r(()=>import("./WeaponSystem-1b538d4d.js"),["assets/WeaponSystem-1b538d4d.js","assets/Bullet-7b575848.js","assets/Entity-ae023216.js"]),{SpawnSystem:i}=await r(()=>import("./SpawnSystem-c448ca05.js"),["assets/SpawnSystem-c448ca05.js","assets/Entity-ae023216.js"]),{UIManager:a}=await r(()=>import("./UIManager-53500332.js"),[]),{AudioManager:s}=await r(()=>import("./AudioManager-bb4fe5fc.js"),[]),{ParticleSystem:n}=await r(()=>import("./ParticleSystem-fdc13a87.js"),[]),{SaveSystem:h}=await r(()=>import("./SaveSystem-6d0b7870.js"),[]),{LevelingSystem:c}=await r(()=>import("./LevelingSystem-162d90e7.js"),[]),{PermanentUpgrades:l}=await r(()=>import("./PermanentUpgrades-9392eb0d.js"),[]);this.inputManager=new e(this.canvas),this.weaponSystem=new t,this.spawnSystem=new i(this.gameArea.width,this.gameArea.height),this.uiManager=new a(this.canvas),this.audioManager=new s,this.particleSystem=new n,this.saveSystem=new h,this.levelingSystem=new c,this.permanentUpgrades=new l,this.systems.set("input",this.inputManager),this.systems.set("weapon",this.weaponSystem),this.systems.set("spawn",this.spawnSystem),this.systems.set("ui",this.uiManager),this.systems.set("audio",this.audioManager),this.systems.set("particle",this.particleSystem),this.systems.set("save",this.saveSystem),this.systems.set("leveling",this.levelingSystem),this.systems.set("upgrades",this.permanentUpgrades)}async loadAssets(){try{const{AssetLoader:e}=await r(()=>import("./AssetLoader-1c516a76.js"),[]);this.assetLoader=e.getInstance(),await Promise.all([this.audioManager.loadAudio(),this.assetLoader.loadAllSprites()]);const t=this.saveSystem.load();this.highScore=t.highScore,console.log("ðŸŽ® All game assets loaded successfully")}catch(e){console.warn("Failed to load some assets:",e)}}setState(e){const t=this.gameState;switch(this.gameState=e,e){case"MENU":this.showMenu();break;case"PLAYING":t!=="PAUSED"&&t!=="LEVEL_UP"&&this.startNewGame(),t==="LEVEL_UP"&&this.uiManager&&this.uiManager.clearPetals();break;case"PAUSED":this.pause();break;case"GAME_OVER":this.gameOver();break;case"LEVEL_UP":this.handleLevelUp();break}}showMenu(){this.entities.clear(),this.score=0,this.gameTime=0,this.levelingSystem&&this.levelingSystem.reset(),this.permanentUpgrades&&this.permanentUpgrades.reset()}async startNewGame(){this.entities.clear(),this.score=0,this.gameTime=0;const{Player:e}=await r(()=>import("./Player-7c36405d.js"),["assets/Player-7c36405d.js","assets/Entity-ae023216.js","assets/AssetLoader-1c516a76.js"]);this.player=new e(this.gameArea.x,this.gameArea.y),this.entities.set("player",this.player),this.spawnSystem.reset(),this.weaponSystem.reset(),this.levelingSystem.reset(),this.permanentUpgrades.reset(),this.audioManager.currentMusic&&this.audioManager.playMusic("bgm")}pause(){this.isPaused=!0}unpause(){this.isPaused=!1,this.setState("PLAYING")}handleLevelUp(){this.isPaused=!0,this.inputManager&&this.inputManager.reset(),this.particleSystem&&this.particleSystem.createLevelUpCelebration(this.canvas.width,this.canvas.height)}selectUpgrade(e){const t=this.levelingSystem.selectUpgrade(e);t&&(this.permanentUpgrades.applyUpgrade(t),this.audioManager.playSound("powerup"),this.player&&this.player.applyPermanentUpgrades(this.permanentUpgrades),this.particleSystem&&this.particleSystem.fadeOutAll(.2),this.uiManager&&this.uiManager.fadeOutPetals(.2),this.isPaused=!1,this.setState("PLAYING"))}gameOver(){const e=this.saveSystem.updateHighScore(this.score);this.saveSystem.save({totalPlayTime:this.gameTime,gamesPlayed:this.saveSystem.load().gamesPlayed+1,enemiesKilled:this.saveSystem.load().enemiesKilled+this.getEnemiesKilled()}),e&&this.audioManager.playSound("highscore")}getEnemiesKilled(){let e=0;return this.entities.forEach(t=>{t.type==="enemy"&&!t.alive&&e++}),e}update(e){this.lastTime||(this.lastTime=e),this.deltaTime=Math.min((e-this.lastTime)/1e3,.1),this.lastTime=e,this.gameState==="PLAYING"&&!this.isPaused&&(this.gameTime+=this.deltaTime,this.updateGameplay(this.deltaTime)),this.handleInput(),this.inputManager.update(),this.render(),requestAnimationFrame(t=>this.update(t))}updateGameplay(e){this.player&&(this.player.update(e,this.inputManager),this.player.constrainToArea(this.gameArea.x,this.gameArea.y,this.gameArea.boundaryRadius)),this.spawnSystem.update(e,this.gameTime),this.spawnSystem.getNewEnemies().forEach(i=>{this.entities.set(`enemy_${i.id}`,i)}),this.entities.forEach((i,a)=>{if(i!==this.player&&i.update(e,this.player),!i.alive){if(i.type==="enemy"){this.score+=i.scoreValue||10,this.audioManager.playSound("explosion"),this.particleSystem.createExplosion(i.x,i.y);const s=i.expValue||10;if(this.levelingSystem.addExperience(s)){this.setState("LEVEL_UP");return}const h=this.spawnSystem.trySpawnPowerUp(i.x,i.y);h&&this.entities.set(`powerup_${h.id}`,h)}this.entities.delete(a)}}),this.checkCollisions(),this.weaponSystem.update(e),this.particleSystem.update(e)}checkCollisions(){const e=Array.from(this.entities.values());for(let t=0;t<e.length;t++)for(let i=t+1;i<e.length;i++){const a=e[t],s=e[i];a.collidesWith(s)&&this.handleCollision(a,s)}}handleCollision(e,t){if(e.type==="player"&&t.type==="enemy")e.takeDamage(t.damage||1),t.destroy(),this.audioManager.playSound("hit");else if(e.type==="enemy"&&t.type==="player")t.takeDamage(e.damage||1),e.destroy(),this.audioManager.playSound("hit");else if(e.type==="bullet"&&t.type==="enemy"){const i=t.takeDamage(e.damage);e.piercing||e.destroy(),i&&(this.particleSystem.createExplosion(t.x,t.y),this.player&&this.permanentUpgrades&&this.permanentUpgrades.processLifesteal(this.player,e.damage))}else if(e.type==="enemy"&&t.type==="bullet"){const i=e.takeDamage(t.damage);t.piercing||t.destroy(),i&&(this.particleSystem.createExplosion(e.x,e.y),this.player&&this.permanentUpgrades&&this.permanentUpgrades.processLifesteal(this.player,t.damage))}else e.type==="player"&&t.type==="powerup"?(t.applyTo(e),t.destroy(),this.audioManager.playSound("powerup")):e.type==="powerup"&&t.type==="player"&&(e.applyTo(t),e.destroy(),this.audioManager.playSound("powerup"))}handleInput(){if(this.inputManager.keys.has("Escape")&&(this.gameState==="PLAYING"?this.setState("PAUSED"):this.gameState==="PAUSED"&&this.unpause()),this.gameState==="MENU"&&(this.inputManager.keys.has("Enter")||this.inputManager.mouse.pressed)&&this.setState("PLAYING"),this.gameState==="GAME_OVER"&&(this.inputManager.keys.has("Enter")||this.inputManager.mouse.pressed)&&this.setState("MENU"),this.gameState==="LEVEL_UP"){this.inputManager.keys.has("Digit1")?this.selectUpgrade(0):this.inputManager.keys.has("Digit2")?this.selectUpgrade(1):this.inputManager.keys.has("Digit3")&&this.selectUpgrade(2);const e=this.inputManager.checkLevelUpCardClick(this);e>=0&&this.selectUpgrade(e)}}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),(this.gameState==="PLAYING"||this.gameState==="PAUSED"||this.gameState==="LEVEL_UP")&&this.renderGameplay(),this.uiManager.render(this)}renderGameplay(){this.ctx.save(),this.renderBoundary(),this.entities.forEach(e=>{e.render(this.ctx)}),this.particleSystem.render(this.ctx),this.ctx.restore()}renderBoundary(){this.ctx.strokeStyle="rgba(255, 255, 255, 0.2)",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(this.gameArea.x,this.gameArea.y,this.gameArea.boundaryRadius,0,Math.PI*2),this.ctx.stroke()}addEntity(e){this.entities.set(`${e.type}_${e.id}`,e)}addScore(e){this.score+=e,this.score>this.highScore&&(this.highScore=this.score)}start(){requestAnimationFrame(e=>this.update(e))}}const f=Object.freeze(Object.defineProperty({__proto__:null,Game:o},Symbol.toStringTag,{value:"Module"}));document.addEventListener("DOMContentLoaded",async()=>{const d=document.getElementById("game-canvas");if(!d){console.error("Canvas element not found!");return}const e=o.getInstance();try{await e.init(d)?(console.log("Game initialized successfully"),e.start()):console.error("Failed to initialize game")}catch(t){console.error("Error initializing game:",t)}window.addEventListener("visibilitychange",()=>{document.hidden&&e.gameState==="PLAYING"&&e.setState("PAUSED")}),window.addEventListener("beforeunload",()=>{e.saveSystem&&e.saveSystem.save({totalPlayTime:e.gameTime,lastPlayed:Date.now()})})});export{f as G,r as _};
