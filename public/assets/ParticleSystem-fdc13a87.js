class y{constructor(t,e,n,r,s,d,f=2){this.x=t,this.y=e,this.vx=n,this.vy=r,this.color=s,this.lifetime=d,this.maxLifetime=d,this.size=f,this.rotation=Math.random()*Math.PI*2,this.rotationSpeed=(Math.random()-.5)*10,this.gravity=0,this.friction=.98,this.fadeOut=!0,this.scaleOut=!0,this.shape="square",this.width=f,this.height=f,this.isFading=!1,this.fadeStartTime=0,this.fadeDuration=0,this.originalLifetime=d}update(t){return this.lifetime-=t,this.vx*=this.friction,this.vy*=this.friction,this.vy+=this.gravity*t,this.x+=this.vx*t,this.y+=this.vy*t,this.rotation+=this.rotationSpeed*t,this.lifetime>0}render(t){t.save();const e=this.lifetime/this.maxLifetime;let n=this.fadeOut?e:1;if(this.isFading&&this.fadeDuration>0){const s=Math.min(1,(this.maxLifetime-this.lifetime-this.fadeStartTime)/this.fadeDuration);n*=1-s}const r=this.scaleOut?.5+e*.5:1;switch(t.globalAlpha=n,t.translate(this.x,this.y),t.rotate(this.rotation),t.scale(r,r),t.fillStyle=this.color,this.shape){case"circle":t.beginPath(),t.arc(0,0,this.size/2,0,Math.PI*2),t.fill();break;case"confetti":t.fillRect(-this.width/2,-this.height/2,this.width,this.height);break;default:t.fillRect(-this.size/2,-this.size/2,this.size,this.size);break}t.restore()}}class b{constructor(){this.particles=[],this.maxParticles=500}update(t){for(let e=this.particles.length-1;e>=0;e--)this.particles[e].update(t)||this.particles.splice(e,1)}render(t){t.save(),t.globalCompositeOperation="lighter",this.particles.forEach(e=>{e.render(t)}),t.restore()}createExplosion(t,e,n={}){const{count:r=20,speed:s=200,speedVariance:d=100,lifetime:f=1,lifetimeVariance:p=.5,colors:i=["#ff0000","#ff8800","#ffff00"],size:l=4,sizeVariance:h=2}=n;for(let c=0;c<r;c++){const m=Math.PI*2*c/r+(Math.random()-.5)*.5,a=s+(Math.random()-.5)*d,o=Math.cos(m)*a,M=Math.sin(m)*a,u=i[Math.floor(Math.random()*i.length)],v=f+(Math.random()-.5)*p,w=l+(Math.random()-.5)*h,g=new y(t,e,o,M,u,v,w);g.friction=.95,g.gravity=50,this.addParticle(g)}}createHit(t,e,n,r={}){const{count:s=10,spread:d=Math.PI/4,speed:f=150,lifetime:p=.5,color:i="#ffff00",size:l=3}=r;for(let h=0;h<s;h++){const c=n+Math.PI+(Math.random()-.5)*d,m=f*(.5+Math.random()*.5),a=Math.cos(c)*m,o=Math.sin(c)*m,M=p*(.5+Math.random()*.5),u=new y(t,e,a,o,i,M,l);u.friction=.9,this.addParticle(u)}}createPowerUp(t,e,n={}){const{count:r=15,speed:s=100,lifetime:d=1.5,colors:f=["#00ff00","#00ffff","#ffffff"],size:p=3}=n;for(let i=0;i<r;i++){const l=Math.PI*2*i/r,h=Math.cos(l)*s,c=Math.sin(l)*s,m=f[Math.floor(Math.random()*f.length)],a=new y(t,e,h,c,m,d,p);a.friction=.92,a.fadeOut=!0,a.scaleOut=!1,this.addParticle(a)}}createTrail(t,e,n,r,s={}){const{count:d=1,spread:f=10,lifetime:p=.3,color:i="rgba(255, 255, 0, 0.5)",size:l=2}=s;for(let h=0;h<d;h++){const c=-n*.1+(Math.random()-.5)*f,m=-r*.1+(Math.random()-.5)*f,a=new y(t,e,c,m,i,p,l);a.fadeOut=!0,a.friction=.8,this.addParticle(a)}}createSpark(t,e,n={}){const{count:r=5,speed:s=300,lifetime:d=.3,color:f="#ffffff",size:p=2}=n;for(let i=0;i<r;i++){const l=Math.random()*Math.PI*2,h=s*(.5+Math.random()*.5),c=Math.cos(l)*h,m=Math.sin(l)*h,a=new y(t,e,c,m,f,d,p);a.friction=.85,a.gravity=200,this.addParticle(a)}}createLevelUpCelebration(t,e,n={}){const{count:r=80,colors:s=["#ff1744","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722"]}=n;[{x:t*.1,y:e*.1},{x:t*.3,y:e*.05},{x:t*.7,y:e*.05},{x:t*.9,y:e*.1}].forEach(i=>{for(let l=0;l<r/4;l++){const h=Math.PI/2+(Math.random()-.5)*Math.PI/3,c=200+Math.random()*300,m=Math.cos(h)*c,a=Math.sin(h)*c,o=s[Math.floor(Math.random()*s.length)],M=2+Math.random()*2,u=new y(i.x,i.y,m,a,o,M);u.shape="confetti",u.width=3+Math.random()*4,u.height=8+Math.random()*6,u.rotationSpeed=(Math.random()-.5)*15,u.gravity=150+Math.random()*100,u.friction=.98,u.fadeOut=!0,u.scaleOut=!1,this.addParticle(u)}});const f=t/2,p=e/2;for(let i=0;i<40;i++){const l=Math.PI*2*i/40+(Math.random()-.5)*.3,h=150+Math.random()*200,c=Math.cos(l)*h,m=Math.sin(l)*h,a=s[Math.floor(Math.random()*s.length)],o=1.5+Math.random()*1.5,M=new y(f,p,c,m,a,o);M.shape=Math.random()>.7?"circle":"confetti",M.shape==="confetti"&&(M.width=2+Math.random()*3,M.height=6+Math.random()*4),M.rotationSpeed=(Math.random()-.5)*12,M.gravity=100+Math.random()*50,M.friction=.97,M.fadeOut=!0,M.scaleOut=!1,this.addParticle(M)}}addParticle(t){this.particles.length<this.maxParticles&&this.particles.push(t)}clear(){this.particles=[]}getParticleCount(){return this.particles.length}createPetalAnimation(t,e,n={}){const{count:r=2,colors:s=["#ff69b4","#ffb6c1","#ffc0cb","#ffdbec","#fff0f5"],minSpeed:d=20,maxSpeed:f=50}=n;for(let p=0;p<r;p++){const i=Math.random()*t,l=-20,h=(Math.random()-.5)*30,c=d+Math.random()*(f-d),m=s[Math.floor(Math.random()*s.length)],a=(e+40)/c,o=new y(i,l,h,c,m,a);o.shape="confetti",o.width=8+Math.random()*6,o.height=10+Math.random()*8,o.rotationSpeed=(Math.random()-.5)*5,o.gravity=0,o.friction=1,o.fadeOut=!1,o.scaleOut=!1,o.swayAmplitude=20+Math.random()*30,o.swayFrequency=.5+Math.random()*1,o.initialX=i,o.timeAlive=0,this.addParticle(o)}}updatePetals(t){this.particles.forEach(e=>{if(e.shape==="confetti"&&e.swayAmplitude!==void 0){e.timeAlive=(e.timeAlive||0)+t;const n=Math.sin(e.timeAlive*e.swayFrequency*Math.PI*2)*e.swayAmplitude;e.x=e.initialX+n}})}fadeOutAll(t=.2){this.particles.forEach(e=>{e.isFading||(e.isFading=!0,e.fadeStartTime=e.maxLifetime-e.lifetime,e.fadeDuration=t,e.lifetime=Math.max(e.lifetime,t))})}}export{y as Particle,b as ParticleSystem};
